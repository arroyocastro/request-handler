kind: ConfigMap
apiVersion: v1
metadata:
  name: request-handler
data:
  application.yml: |-
    server:
      port: 8989
    spring:
      application:
        name: request-handler
      cloud:
        gateway:
          default-filters:
            - DedupeResponseHeader=Access-Control-Allow-Origin Access-Control-Allow-Credentials, RETAIN_UNIQUE
          routes:
            - id: schemaService
              uri: http://10.66.78.2:32201
              predicates:
                - Path=/schema/**
            - id: party
              uri: lb://party
              predicates:
                - Path=/party/**
            - id: producto
              uri: lb://product
              predicates:
                - Path=/product/**
            - id: keycloack-connector
              uri: http://10.66.78.2:3005
              predicates:
                - Path=/keycloack/**
            - id: common
              uri: lb://common
              predicates:
                - Path=/common/**
            - id: orders
              uri: lb://orders
              predicates:
                - Path=/orders/**
          globalcors:
            add-to-simple-url-handler-mapping: true
            corsConfigurations:
              "[/**]":
                allowed-origins: "http://10.66.78.2:32202"
                allowed-methods:
                  - GET
                  - POST
                  - PUT
                  - OPTIONS
                allowed-headers:
                  - "*"
                allow-credentials: true
      security:
        oauth2:
          resourceserver:
            jwt:
              jwk-set-uri: http://10.66.78.2:32150/realms/Tekingb/protocol/openid-connect/certs
    logging:
      level:
        org.springframework.security: INFO
        org.springframework.cloud.gateway: INFO
        com.felips: INFO
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: request-handler
  labels:
    app: request-handler
spec:
  selector:
    matchLabels:
      app: request-handler
  template:
    metadata:
      labels:
        app: request-handler
    spec:
      containers:
      - name: request-handler
        image: request-handler
        imagePullPolicy: IfNotPresent
        ports:
        - containerPort: 8989
---
apiVersion: v1
kind: Service
metadata:
  name: request-handler
spec:
  type: NodePort
  selector:
    app: request-handler
  ports:
    - port: 8989
      targetPort: 8989
      nodePort: 32200
